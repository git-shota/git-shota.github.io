<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
  <meta name="theme-color" content="#FF6B9D" />
  <meta name="mobile-web-app-capable" content="yes" />
  <meta name="application-name" content="„Åä„Åó„Åî„Å®„ÉÅ„É£„É¨„É≥„Ç∏" />
  <link rel="manifest" href="manifest.json" />
  <title>„Åä„Åó„Åî„Å® „ÉÅ„É£„É¨„É≥„Ç∏ÔºÅ</title>
  <style>
    * { box-sizing: border-box; margin: 0; padding: 0; -webkit-tap-highlight-color: transparent; }
    body {
      min-height: 100dvh;
      background: linear-gradient(135deg, #ffe4f0 0%, #fff9e6 50%, #e4f0ff 100%);
      font-family: 'Hiragino Kaku Gothic Pro', 'Meiryo', sans-serif;
      display: flex; flex-direction: column; align-items: center;
      padding: 16px; padding-bottom: 32px;
      overflow-x: hidden;
    }
    @keyframes burst { 0%{transform:scale(0) rotate(0);opacity:1} 100%{transform:scale(3) rotate(180deg);opacity:0} }
    @keyframes pop { 0%{transform:scale(0.5) translateX(-50%);opacity:0} 60%{transform:scale(1.2) translateX(-50%)} 100%{transform:scale(1) translateX(-50%);opacity:1} }
    @keyframes bounce { 0%,100%{transform:translateY(0)} 50%{transform:translateY(-8px)} }
    @keyframes shine { 0%,100%{filter:brightness(1)} 50%{filter:brightness(1.3)} }
    @keyframes wiggle { 0%,100%{transform:rotate(0)} 25%{transform:rotate(-5deg)} 75%{transform:rotate(5deg)} }
    @keyframes fadeIn { from{opacity:0;transform:translateY(20px)} to{opacity:1;transform:translateY(0)} }

    #app { width: 100%; max-width: 440px; display: flex; flex-direction: column; align-items: center; }

    /* Header */
    .header { text-align: center; margin-bottom: 20px; }
    .header-rainbow { font-size: 40px; animation: bounce 2s infinite; display: block; }
    .header-title { font-size: 26px; font-weight: bold; color: #FF6B9D; margin: 4px 0; text-shadow: 2px 2px 0 #FFD700; }
    .header-char { font-size: 18px; font-weight: bold; }

    /* Burst star */
    .burst { position: fixed; font-size: 40px; pointer-events: none; z-index: 999; animation: burst 0.8s ease-out forwards; }

    /* Praise */
    .praise {
      position: fixed; top: 30%; left: 50%;
      background: white; border-radius: 24px; padding: 16px 32px;
      font-size: 22px; font-weight: bold; z-index: 1000;
      box-shadow: 0 8px 32px rgba(0,0,0,0.15);
      animation: pop 0.3s ease-out forwards;
    }

    /* Select screen */
    .select-hint { font-size: 20px; color: #666; margin-bottom: 24px; }
    .char-row { display: flex; gap: 20px; justify-content: center; }
    .char-btn {
      background: white; border-radius: 24px; padding: 24px 28px;
      cursor: pointer; box-shadow: 0 6px 20px rgba(0,0,0,0.1);
      animation: wiggle 3s infinite; text-align: center;
      transition: transform 0.2s; border: 4px solid transparent;
    }
    .char-btn:active { transform: scale(0.93); }
    .char-avatar { font-size: 60px; display: block; }
    .char-name { font-size: 20px; font-weight: bold; margin-top: 8px; }
    .char-stars { font-size: 13px; color: #999; margin-top: 4px; }

    /* Tasks screen */
    .progress-box {
      background: white; border-radius: 16px; padding: 12px 16px;
      margin-bottom: 16px; box-shadow: 0 4px 12px rgba(0,0,0,0.08); width: 100%;
    }
    .progress-row { display: flex; justify-content: space-between; margin-bottom: 6px; }
    .progress-label { font-size: 15px; color: #666; }
    .progress-count { font-size: 15px; font-weight: bold; }
    .progress-bar-bg { background: #eee; border-radius: 99px; height: 14px; overflow: hidden; }
    .progress-bar { height: 100%; border-radius: 99px; transition: width 0.5s ease; box-shadow: 0 2px 6px rgba(255,215,0,0.5); }

    .task-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 12px; width: 100%; }
    .task-btn {
      background: white; border: 3px solid #eee; border-radius: 20px;
      padding: 18px 10px; cursor: pointer;
      box-shadow: 0 4px 12px rgba(0,0,0,0.06);
      position: relative; transition: transform 0.15s; text-align: center;
    }
    .task-btn:active { transform: scale(0.93); }
    .task-btn.done { animation: shine 2s infinite; }
    .task-emoji { font-size: 44px; display: block; }
    .task-label { font-size: 14px; font-weight: bold; color: #555; margin-top: 6px; line-height: 1.3; }
    .task-label.done-label { color: inherit; }
    .task-star-badge { position: absolute; top: 6px; right: 8px; font-size: 18px; }

    .reward-btn {
      width: 100%; margin-top: 20px; padding: 18px;
      background: linear-gradient(135deg, #FF6B9D, #FFD700);
      border: none; border-radius: 20px; font-size: 22px; font-weight: bold;
      color: white; cursor: pointer; animation: bounce 0.8s infinite;
      box-shadow: 0 6px 24px rgba(255,107,157,0.5);
    }
    .back-btn { margin-top: 12px; background: transparent; border: none; color: #aaa; font-size: 14px; cursor: pointer; width: 100%; padding: 8px; }

    /* Reward screen */
    .reward-screen { text-align: center; animation: fadeIn 0.5s ease-out; }
    .reward-trophy { font-size: 88px; animation: bounce 1s infinite; display: block; }
    .reward-title { font-size: 28px; font-weight: bold; color: #FF6B9D; text-shadow: 2px 2px 0 #FFD700; margin: 12px 0; }
    .reward-avatar { font-size: 68px; margin: 12px 0; display: block; }
    .reward-sub { font-size: 20px; color: #666; }
    .reward-msg { font-size: 22px; font-weight: bold; margin-bottom: 20px; }
    .reward-box {
      background: white; border-radius: 20px; padding: 20px;
      box-shadow: 0 6px 24px rgba(0,0,0,0.1); margin-bottom: 20px;
    }
    .reward-box-label { font-size: 16px; color: #999; margin-bottom: 8px; }
    .reward-box-num { font-size: 52px; font-weight: bold; color: #FFD700; }
    .reward-box-stars { font-size: 28px; margin-top: 4px; word-break: break-all; }
    .home-btn {
      padding: 16px 40px;
      background: linear-gradient(135deg, #FF6B9D, #FFB347);
      border: none; border-radius: 20px; font-size: 20px; font-weight: bold;
      color: white; cursor: pointer; box-shadow: 0 6px 20px rgba(255,107,157,0.4);
    }
  </style>
</head>
<body>
<div id="app"></div>

<script>
const TASKS = [
  { id:1, emoji:"ü¶∑", label:"„ÅØ„Åø„Åå„Åç",           color:"#FF6B9D" },
  { id:2, emoji:"üëó", label:"„Åç„Åå„Åà",             color:"#FFB347" },
  { id:3, emoji:"üëú", label:"„Åã„Å∞„Çì„ÅÆ „Åò„ÇÖ„Çì„Å≥",   color:"#87CEEB" },
  { id:4, emoji:"üç±", label:"„Åä„Åπ„Çì„Å®„ÅÜ„ÅÆ „Åò„ÇÖ„Çì„Å≥",color:"#98FB98" },
  { id:5, emoji:"ü§≤", label:"„Å¶„ÅÇ„Çâ„ÅÑ",           color:"#DDA0DD" },
  { id:6, emoji:"üõèÔ∏è", label:"„Åä„Åµ„Å®„Çì „Åü„Åü„ÇÄ",     color:"#F0E68C" },
  { id:7, emoji:"üçΩÔ∏è", label:"„Åä„Åï„Çâ „Åã„Åü„Å•„Åë",     color:"#FFB6C1" },
  { id:8, emoji:"üß∏", label:"„Åä„ÇÇ„Å°„ÇÉ „Åã„Åü„Å•„Åë",   color:"#B0E0E6" },
];

const CHARS = [
  { name:"„ÅÇ„ÇÑ„Åø", avatar:"üßí", color:"#FF6B9D" },
  { name:"„Å≤„Å™„Åø", avatar:"üëß", color:"#FFB347" },
];

const PRAISE = [
  "„ÇÑ„Å£„Åü„Å≠ÔºÅ„Åô„Åî„ÅÑÔºÅ‚ú®","„Åà„Çâ„ÅÑÔºÅ„Åã„Å£„Åì„ÅÑ„ÅÑÔºÅüåü",
  "„Åß„Åç„ÅüÔºÅ„Å≤„Åã„Å£„Å¶„Çã„ÇàÔºÅüí´","„Åï„ÅÑ„Åì„ÅÜÔºÅ„Åä„ÅÜ„Åà„Çì„Åó„Å¶„Çã„ÇàÔºÅüéâ",
  "„Åô„Å∞„Çâ„Åó„ÅÑÔºÅ„Éó„É™„É≥„Çª„Çπ„Åø„Åü„ÅÑÔºÅüëë",
];

let state = {
  screen: "select", // select | tasks | reward
  activeChar: null,
  done: {},
  totalStars: [0, 0],
};

// Persist stars
function loadStars() {
  try { const s = JSON.parse(localStorage.getItem("oshigoto_stars")); if(s) state.totalStars = s; } catch(e){}
}
function saveStars() {
  try { localStorage.setItem("oshigoto_stars", JSON.stringify(state.totalStars)); } catch(e){}
}
loadStars();

const app = document.getElementById("app");

function el(tag, attrs={}, ...children) {
  const e = document.createElement(tag);
  for(const [k,v] of Object.entries(attrs)) {
    if(k === "style" && typeof v === "object") Object.assign(e.style, v);
    else if(k.startsWith("on")) e.addEventListener(k.slice(2).toLowerCase(), v);
    else e.setAttribute(k, v);
  }
  for(const c of children) {
    if(c == null) continue;
    e.appendChild(typeof c === "string" ? document.createTextNode(c) : c);
  }
  return e;
}

function spawnBurst(x, y) {
  const b = el("div", { class:"burst", style:{ left:(x-30)+"px", top:(y-30)+"px" } }, "‚≠ê");
  document.body.appendChild(b);
  setTimeout(() => b.remove(), 900);
}

function showPraise(color) {
  const msg = PRAISE[Math.floor(Math.random()*PRAISE.length)];
  const p = el("div", { class:"praise", style:{ color } }, msg);
  document.body.appendChild(p);
  setTimeout(() => p.remove(), 1500);
}

function render() {
  app.innerHTML = "";
  const { screen, activeChar, done, totalStars } = state;
  const char = activeChar !== null ? CHARS[activeChar] : null;

  // Header
  const completedCount = Object.values(done).filter(Boolean).length;
  const hdr = el("div", { class:"header" },
    el("span", { class:"header-rainbow" }, "üåà"),
    el("h1", { class:"header-title" }, "„Åä„Åó„Åî„Å® „ÉÅ„É£„É¨„É≥„Ç∏ÔºÅ"),
    char ? el("div", { class:"header-char", style:{ color:char.color } },
      `${char.avatar} ${char.name}„Å°„ÇÉ„Çì ‚≠ê√ó${totalStars[activeChar]}`
    ) : null
  );
  app.appendChild(hdr);

  if(screen === "select") renderSelect();
  else if(screen === "tasks") renderTasks(completedCount);
  else renderReward();
}

function renderSelect() {
  app.appendChild(el("p", { class:"select-hint" }, "„Å†„Çå„Åå „ÇÑ„ÇãÔºü „Çø„ÉÉ„Éó„Åó„Å¶„Å≠ÔºÅ"));
  const row = el("div", { class:"char-row" });
  CHARS.forEach((c,i) => {
    const btn = el("div", { class:"char-btn", style:{ borderColor:c.color, boxShadow:`0 6px 20px ${c.color}55`, animationDelay:`${i*0.5}s` },
      onclick:() => { state.activeChar=i; state.done={}; state.screen="tasks"; render(); }
    },
      el("span", { class:"char-avatar" }, c.avatar),
      el("div", { class:"char-name", style:{ color:c.color } }, c.name),
      el("div", { class:"char-stars" }, `‚≠ê√ó${state.totalStars[i]}`)
    );
    row.appendChild(btn);
  });
  app.appendChild(row);
}

function renderTasks(completedCount) {
  const { done, activeChar } = state;
  const char = CHARS[activeChar];
  const allDone = completedCount === TASKS.length;

  // Progress
  const pct = (completedCount / TASKS.length * 100) + "%";
  const prog = el("div", { class:"progress-box" },
    el("div", { class:"progress-row" },
      el("span", { class:"progress-label" }, "„Åß„Åç„ÅüÔºÅ"),
      el("span", { class:"progress-count", style:{ color:char.color } }, `${completedCount} / ${TASKS.length}`)
    ),
    el("div", { class:"progress-bar-bg" },
      el("div", { class:"progress-bar", style:{ width:pct, background:`linear-gradient(90deg,${char.color},#FFD700)` } })
    )
  );
  app.appendChild(prog);

  // Grid
  const grid = el("div", { class:"task-grid" });
  TASKS.forEach(t => {
    const isDone = !!done[t.id];
    const btn = el("div", {
      class: "task-btn" + (isDone?" done":""),
      style: isDone
        ? { background:`linear-gradient(135deg,${t.color}88,${t.color}44)`, borderColor:t.color, boxShadow:`0 4px 16px ${t.color}66` }
        : {},
      onclick: isDone ? null : (e) => {
        const r = btn.getBoundingClientRect();
        spawnBurst(r.left+r.width/2, r.top+r.height/2);
        showPraise(char.color);
        state.done[t.id] = true;
        state.totalStars[activeChar]++;
        saveStars();
        render();
      }
    },
      el("span", { class:"task-emoji" }, isDone?"‚úÖ":t.emoji),
      el("div", { class:"task-label"+(isDone?" done-label":""), style: isDone?{color:t.color}:{} }, t.label),
      isDone ? el("span", { class:"task-star-badge" }, "‚≠ê") : null
    );
    grid.appendChild(btn);
  });
  app.appendChild(grid);

  if(allDone) {
    const rb = el("button", { class:"reward-btn",
      onclick:()=>{ state.screen="reward"; render(); }
    }, "üéâ „Åî„Åª„ÅÜ„Å≥„Çí „Åø„ÇãÔºÅ");
    app.appendChild(rb);
  }

  const back = el("button", { class:"back-btn",
    onclick:()=>{ state.screen="select"; state.activeChar=null; state.done={}; render(); }
  }, "‚Üê „ÇÇ„Å©„Çã");
  app.appendChild(back);
}

function renderReward() {
  const { activeChar, totalStars } = state;
  const char = CHARS[activeChar];
  const stars = Math.min(totalStars[activeChar], 20);

  const div = el("div", { class:"reward-screen" },
    el("span", { class:"reward-trophy" }, "üèÜ"),
    el("h2", { class:"reward-title" }, "„Åú„Çì„Å∂ „Åß„Åç„Åü„ÇàÔºÅÔºÅ"),
    el("span", { class:"reward-avatar" }, char.avatar),
    el("p", { class:"reward-sub" }, `${char.name}„Å°„ÇÉ„Çì„ÅØ`),
    el("p", { class:"reward-msg", style:{ color:char.color } }, "„Åô„Åî„ÅÑÔºÅ„Åã„Å£„Åì„ÅÑ„ÅÑÔºÅ„Åà„Çâ„ÅÑÔºÅüåü"),
    el("div", { class:"reward-box" },
      el("p", { class:"reward-box-label" }, "„ÅÇ„Å§„ÇÅ„Åü ‚≠ê"),
      el("p", { class:"reward-box-num" }, `√ó${totalStars[activeChar]}`),
      el("div", { class:"reward-box-stars" }, "‚≠ê".repeat(stars))
    ),
    el("button", { class:"home-btn",
      onclick:()=>{ state.screen="select"; state.activeChar=null; state.done={}; render(); }
    }, "üëë „Åä„ÅÜ„Å°„Å´ „Åã„Åà„Çã")
  );
  app.appendChild(div);
}

render();

if("serviceWorker" in navigator) {
  navigator.serviceWorker.register("sw.js").catch(()=>{});
}
</script>
</body>
</html>
