<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
  <meta name="theme-color" content="#FF6B9D" />
  <meta name="mobile-web-app-capable" content="yes" />
  <meta name="application-name" content="„Åã„Åû„Åè„Ç´„É¨„É≥„ÉÄ„Éº" />
  <link rel="manifest" href="manifest.json" />
  <title>„Åã„Åû„Åè„Ç´„É¨„É≥„ÉÄ„Éº</title>
  <style>
    *{box-sizing:border-box;margin:0;padding:0;-webkit-tap-highlight-color:transparent;}
    body{
      min-height:100dvh;background:#f8f9fb;
      font-family:'Hiragino Kaku Gothic Pro','Meiryo',sans-serif;
      max-width:480px;margin:0 auto;padding-bottom:80px;
    }
    input{font-family:inherit;}
    button{font-family:inherit;cursor:pointer;}

    /* Header */
    #header{
      background:linear-gradient(135deg,#FF6B9D,#FFB347);
      padding:16px 16px 12px;position:sticky;top:0;z-index:10;
    }
    #header-inner{display:flex;align-items:center;justify-content:space-between;}
    #header-sub{font-size:11px;color:rgba(255,255,255,0.8);}
    #header-title{font-size:20px;font-weight:bold;color:white;}
    #header-avatars{display:flex;gap:4px;}
    .avatar-chip{width:30px;height:30px;border-radius:50%;background:rgba(255,255,255,0.3);display:flex;align-items:center;justify-content:center;font-size:16px;}

    /* Bottom tabs */
    #tabs{
      position:fixed;bottom:0;left:50%;transform:translateX(-50%);
      width:100%;max-width:480px;background:white;border-top:1px solid #eee;
      display:flex;z-index:10;
    }
    .tab-btn{
      flex:1;background:none;border:none;padding:10px 0;font-size:11px;color:#aaa;
      border-top:3px solid transparent;
    }
    .tab-btn.active{color:#FF6B9D;font-weight:bold;border-top-color:#FF6B9D;}

    /* Content */
    #content{padding:16px;}

    /* Cards */
    .card{background:white;border-radius:14px;padding:14px;margin-bottom:12px;box-shadow:0 2px 8px rgba(0,0,0,0.06);}

    /* Calendar */
    #cal-nav{display:flex;align-items:center;justify-content:space-between;margin-bottom:12px;}
    .nav-btn{background:white;border:1px solid #eee;border-radius:8px;padding:6px 14px;font-size:18px;color:#555;}
    #cal-month{font-weight:bold;font-size:18px;color:#333;}
    #cal-weekdays{display:grid;grid-template-columns:repeat(7,1fr);gap:2px;margin-bottom:4px;}
    .wd{text-align:center;font-size:11px;font-weight:bold;padding:4px 0;}
    #cal-grid{display:grid;grid-template-columns:repeat(7,1fr);gap:2px;}
    .cal-cell{
      min-height:60px;background:white;border:1px solid #eee;
      border-radius:10px;padding:4px 3px;cursor:pointer;
      transition:box-shadow 0.15s;
    }
    .cal-cell:active{box-shadow:0 2px 8px rgba(0,0,0,0.12);}
    .cal-cell.today{background:#fff0f6;border:2px solid #FF6B9D;}
    .day-num{
      text-align:center;font-size:12px;border-radius:50%;
      width:20px;height:20px;line-height:20px;margin:0 auto 2px;
    }
    .day-num.today{background:#FF6B9D;color:white;font-weight:bold;}
    .day-num.sun{color:#E53935;}
    .day-num.sat{color:#1976D2;}
    .ev-chip{
      font-size:9px;border-radius:3px;padding:1px 3px;margin-bottom:1px;
      border-left:2px solid;overflow:hidden;white-space:nowrap;text-overflow:ellipsis;
    }
    .ev-more{font-size:9px;color:#999;}
    #today-events{margin-top:16px;}
    #today-events h3{font-weight:bold;font-size:14px;margin-bottom:8px;color:#333;}
    .ev-row{display:flex;align-items:center;gap:8px;padding:6px 0;border-bottom:1px solid #f5f5f5;}
    .ev-dot{width:8px;height:8px;border-radius:50%;flex-shrink:0;}
    .ev-title{font-size:13px;flex:1;}
    .ev-tag{font-size:11px;border-radius:20px;padding:1px 8px;}
    .del-btn{background:none;border:none;color:#ccc;font-size:14px;padding:0;}

    /* Tasks */
    .mem-header{display:flex;align-items:center;justify-content:space-between;margin-bottom:10px;}
    .mem-title{display:flex;align-items:center;gap:8px;}
    .mem-emoji{font-size:24px;}
    .mem-name{font-weight:bold;font-size:16px;}
    .mem-count{font-size:12px;border-radius:20px;padding:2px 10px;}
    .progress-bg{background:#eee;border-radius:99px;height:8px;margin-bottom:10px;overflow:hidden;}
    .progress-bar{height:100%;border-radius:99px;transition:width 0.4s;}
    .task-row{display:flex;align-items:center;gap:10px;padding:8px 4px;cursor:pointer;border-bottom:1px solid #f5f5f5;}
    .task-emoji{font-size:22px;}
    .task-label{flex:1;font-size:14px;}
    .task-label.done{text-decoration:line-through;color:#aaa;}
    .add-btn{
      display:flex;align-items:center;gap:4px;background:white;
      border:1px dashed #ddd;border-radius:8px;padding:7px 12px;font-size:13px;color:#999;
      margin-top:8px;
    }

    /* Meals */
    .meal-day-title{font-weight:bold;font-size:15px;margin-bottom:10px;color:#333;}
    .meal-row{display:flex;align-items:center;gap:8px;margin-bottom:8px;}
    .meal-slot{font-size:13px;color:#666;width:80px;flex-shrink:0;}
    .meal-input{
      flex:1;border:1px solid #eee;border-radius:8px;padding:6px 10px;font-size:13px;outline:none;
    }

    /* Lists */
    .list-header{display:flex;align-items:center;justify-content:space-between;margin-bottom:10px;}
    .list-title-row{display:flex;align-items:center;gap:8px;}
    .list-color-dot{width:12px;height:12px;border-radius:3px;}
    .list-title{font-weight:bold;font-size:15px;}
    .list-count{font-size:12px;color:#999;}
    .list-item-row{display:flex;align-items:center;gap:8px;padding:6px 0;border-bottom:1px solid #f5f5f5;}
    .check-box{width:18px;height:18px;border-radius:4px;border:2px solid #ddd;background:white;cursor:pointer;flex-shrink:0;display:flex;align-items:center;justify-content:center;}
    .check-box.checked{border-color:inherit;background:inherit;}
    .item-text{flex:1;font-size:13px;}
    .item-text.done{text-decoration:line-through;color:#aaa;}
    .add-item-row{display:flex;gap:6px;margin-top:8px;}
    .add-item-input{flex:1;border:1px solid #eee;border-radius:8px;padding:6px 10px;font-size:13px;outline:none;}
    .add-item-btn{border:none;border-radius:8px;color:white;padding:6px 12px;font-size:13px;}
    .add-list-btn{
      width:100%;background:white;border:1px dashed #ddd;border-radius:10px;
      padding:12px;font-size:14px;color:#999;
    }

    /* Modal */
    .modal-overlay{position:fixed;inset:0;background:rgba(0,0,0,0.4);z-index:100;display:flex;align-items:flex-end;justify-content:center;}
    .modal-box{background:white;border-radius:20px 20px 0 0;padding:20px;width:100%;max-width:480px;max-height:80vh;overflow-y:auto;}
    .modal-title{font-weight:bold;font-size:16px;margin-bottom:14px;color:#333;}
    .modal-label{font-size:12px;color:#666;margin-bottom:4px;}
    .modal-input{width:100%;border:1px solid #eee;border-radius:10px;padding:10px 12px;font-size:14px;outline:none;}
    .modal-confirm{width:100%;border:none;border-radius:12px;padding:12px;color:white;font-weight:bold;font-size:15px;margin-top:8px;}
    .modal-cancel{width:100%;border:none;border-radius:12px;padding:12px;background:#eee;color:#999;font-weight:bold;font-size:15px;margin-top:6px;}
    .chip-btn{padding:6px 12px;border-radius:20px;border:2px solid;font-size:13px;background:white;}
    .emoji-btn{padding:6px 10px;border-radius:10px;border:2px solid #eee;background:white;font-size:20px;}
    .emoji-btn.active{border-color:#FF6B9D;background:#fff0f6;}
    .color-dot-sel{width:28px;height:28px;border-radius:50%;border:3px solid transparent;cursor:pointer;}
  </style>
</head>
<body>

<div id="header">
  <div id="header-inner">
    <div>
      <div id="header-sub">üë®‚Äçüë©‚Äçüëß‚Äçüëß „Åã„Åû„Åè„ÅÆ„Ç´„É¨„É≥„ÉÄ„Éº</div>
      <div id="header-title">Skylight üìÖ</div>
    </div>
    <div id="header-avatars"></div>
  </div>
</div>

<div id="content"></div>

<div id="tabs"></div>

<script>
// ‚îÄ‚îÄ „Éá„Éº„Çø ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
const MEMBERS = [
  {id:1,name:"„Éë„Éë",  color:"#4A90D9",emoji:"üë®"},
  {id:2,name:"„Éû„Éû",  color:"#E91E8C",emoji:"üë©"},
  {id:3,name:"„ÅÇ„ÇÑ„Åø",color:"#FF6B9D",emoji:"üßí"},
  {id:4,name:"„Å≤„Å™„Åø",color:"#FFB347",emoji:"üëß"},
];
const TASK_TEMPLATES=[
  {emoji:"ü¶∑",label:"„ÅØ„Åø„Åå„Åç"},{emoji:"üëó",label:"„Åç„Åå„Åà"},
  {emoji:"ü§≤",label:"„Å¶„ÅÇ„Çâ„ÅÑ"},{emoji:"üõèÔ∏è",label:"„Åä„Åµ„Å®„Çì"},
  {emoji:"üß∏",label:"„Åã„Åü„Å•„Åë"},{emoji:"üçΩÔ∏è",label:"„Åä„Åï„Çâ"},
];
const TABS=["üìÖ „Ç´„É¨„É≥„ÉÄ„Éº","‚úÖ „Çø„Çπ„ÇØ","üçΩÔ∏è „Åì„Çì„Å†„Å¶","üìã „É™„Çπ„Éà"];
const WEEKDAYS=["Êó•","Êúà","ÁÅ´","Ê∞¥","Êú®","Èáë","Âúü"];

function pad(n){return String(n).padStart(2,"0");}
function dateKey(y,m,d){return `${y}-${pad(m+1)}-${pad(d)}`;}
function todayKey(){const t=new Date();return dateKey(t.getFullYear(),t.getMonth(),t.getDate());}

// ‚îÄ‚îÄ State ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
let state={
  tab:0,
  year:new Date().getFullYear(),
  month:new Date().getMonth(),
  events:{},
  tasks:[
    {id:1,memberId:3,emoji:"ü¶∑",label:"„ÅØ„Åø„Åå„Åç",done:false},
    {id:2,memberId:3,emoji:"üëó",label:"„Åç„Åå„Åà",  done:false},
    {id:3,memberId:4,emoji:"ü§≤",label:"„Å¶„ÅÇ„Çâ„ÅÑ",done:false},
    {id:4,memberId:4,emoji:"üß∏",label:"„Åã„Åü„Å•„Åë",done:false},
  ],
  meals:{},
  lists:[
    {id:1,title:"„Åã„ÅÑ„ÇÇ„ÅÆ",color:"#4CAF50",items:[
      {id:1,text:"„Åé„ÇÖ„ÅÜ„Å´„ÇÖ„ÅÜ",done:false},{id:2,text:"„Åü„Åæ„Åî",done:false},{id:3,text:"„Éë„É≥",done:false}
    ]},
    {id:2,title:"„ÇÑ„Çã„Åì„Å®",color:"#2196F3",items:[
      {id:1,text:"„Çà„Å≥„Åì„ÅÜ",done:false},{id:2,text:"„Å®„Åó„Çá„Åã„Çì",done:true}
    ]},
  ],
  modal:null, // {type, ...}
};

function setState(patch){Object.assign(state,patch);render();}

// ‚îÄ‚îÄ Helpers ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
function el(tag,attrs={},children=[]){
  const e=document.createElement(tag);
  for(const [k,v] of Object.entries(attrs)){
    if(k==="style"&&typeof v==="object") Object.assign(e.style,v);
    else if(k.startsWith("on")) e.addEventListener(k.slice(2).toLowerCase(),v);
    else if(k==="className") e.className=v;
    else e.setAttribute(k,v);
  }
  for(const c of (Array.isArray(children)?children:[children])){
    if(c==null) continue;
    e.appendChild(typeof c==="string"?document.createTextNode(c):c);
  }
  return e;
}
function div(cls,children=[],attrs={}){return el("div",{className:cls,...attrs},children);}

// ‚îÄ‚îÄ Render ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
function render(){
  renderHeader();
  renderTabs();
  renderContent();
  renderModal();
}

function renderHeader(){
  const av=document.getElementById("header-avatars");
  av.innerHTML="";
  MEMBERS.forEach(m=>av.appendChild(div("avatar-chip",[m.emoji])));
}

function renderTabs(){
  const tabs=document.getElementById("tabs");
  tabs.innerHTML="";
  TABS.forEach((t,i)=>{
    const b=el("button",{className:"tab-btn"+(state.tab===i?" active":""),onclick:()=>setState({tab:i})},[t]);
    tabs.appendChild(b);
  });
}

function renderContent(){
  const c=document.getElementById("content");
  c.innerHTML="";
  if(state.tab===0) c.appendChild(renderCalendar());
  if(state.tab===1) c.appendChild(renderTasks());
  if(state.tab===2) c.appendChild(renderMeals());
  if(state.tab===3) c.appendChild(renderLists());
}

// ‚îÄ‚îÄ Calendar ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
function renderCalendar(){
  const {year,month,events}=state;
  const tk=todayKey();
  const frag=document.createDocumentFragment();

  // Nav
  const nav=div("card",[
    el("div",{id:"cal-nav"},[
      el("button",{className:"nav-btn",onclick:()=>{
        if(month===0) setState({month:11,year:year-1});
        else setState({month:month-1});
      }},["‚Äπ"]),
      el("span",{id:"cal-month"},[`${year}Âπ¥ ${month+1}Êúà`]),
      el("button",{className:"nav-btn",onclick:()=>{
        if(month===11) setState({month:0,year:year+1});
        else setState({month:month+1});
      }},["‚Ä∫"]),
    ])
  ]);
  frag.appendChild(nav);

  // Weekdays
  const wdRow=div("",[]); wdRow.id="cal-weekdays";
  WEEKDAYS.forEach((w,i)=>{
    const d=el("div",{className:"wd",style:{color:i===0?"#E53935":i===6?"#1976D2":"#666"}},[w]);
    wdRow.appendChild(d);
  });

  // Grid
  const firstDay=new Date(year,month,1).getDay();
  const daysInMonth=new Date(year,month+1,0).getDate();
  const grid=el("div",{id:"cal-grid"},[]);

  for(let i=0;i<firstDay;i++) grid.appendChild(el("div",{}));

  for(let d=1;d<=daysInMonth;d++){
    const key=dateKey(year,month,d);
    const isToday=key===tk;
    const dow=(firstDay+d-1)%7;
    const dayEvents=events[key]||[];

    const numCls="day-num"+(isToday?" today":dow===0?" sun":dow===6?" sat":"");
    const cell=el("div",{
      className:"cal-cell"+(isToday?" today":""),
      onclick:()=>openEventModal(key)
    },[
      el("div",{className:numCls},[String(d)]),
      ...dayEvents.slice(0,2).map(ev=>
        el("div",{className:"ev-chip",style:{
          background:ev.color+"22",color:ev.color,borderLeftColor:ev.color
        }},[ev.title])
      ),
      dayEvents.length>2?el("div",{className:"ev-more"},[`+${dayEvents.length-2}`]):null,
    ].filter(Boolean));
    grid.appendChild(cell);
  }

  const calBox=div("card",[wdRow,grid]);
  frag.appendChild(calBox);

  // Today list
  const todayEvs=events[tk]||[];
  const todayBox=div("card",[
    el("h3",{},[`üìÖ „Åç„Çá„ÅÜ„ÅÆ „Çà„Å¶„ÅÑ`]),
    todayEvs.length===0
      ? el("div",{style:{color:"#aaa",fontSize:"13px"}},["„Çà„Å¶„ÅÑ„ÅØ„ÅÇ„Çä„Åæ„Åõ„Çì"])
      : el("div",{},[
          ...todayEvs.map(ev=>{
            const mem=MEMBERS.find(m=>m.id===ev.memberId);
            return div("ev-row",[
              el("div",{className:"ev-dot",style:{background:ev.color}}),
              el("span",{className:"ev-title"},[ev.title]),
              el("span",{className:"ev-tag",style:{color:ev.color,background:ev.color+"22"}},[`${mem?.emoji}${mem?.name}`]),
              el("button",{className:"del-btn",onclick:()=>deleteEvent(tk,ev.id)},["√ó"]),
            ]);
          })
        ])
  ]);
  frag.appendChild(todayBox);

  return frag;
}

function openEventModal(key){
  state.modal={type:"event",key,title:"",memberId:1};
  render();
}
function deleteEvent(key,id){
  const updated=(state.events[key]||[]).filter(e=>e.id!==id);
  state.events={...state.events,[key]:updated};
  render();
}

// ‚îÄ‚îÄ Tasks ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
function renderTasks(){
  const frag=document.createDocumentFragment();
  MEMBERS.slice(2).forEach(mem=>{
    const memTasks=state.tasks.filter(t=>t.memberId===mem.id);
    const done=memTasks.filter(t=>t.done).length;
    const pct=memTasks.length?done/memTasks.length*100:0;

    const card=div("card",[
      div("mem-header",[
        div("mem-title",[
          el("span",{className:"mem-emoji"},[mem.emoji]),
          el("span",{className:"mem-name",style:{color:mem.color}},[`${mem.name}„Å°„ÇÉ„Çì`]),
        ]),
        el("span",{className:"mem-count",style:{color:mem.color,background:mem.color+"22"}},[`${done}/${memTasks.length} ‚≠ê`]),
      ]),
      div("progress-bg",[
        el("div",{className:"progress-bar",style:{width:`${pct}%`,background:`linear-gradient(90deg,${mem.color},#FFD700)`}})
      ]),
      el("div",{},[
        ...memTasks.map(t=>
          div("task-row",[
            el("span",{className:"task-emoji"},[t.done?"‚úÖ":t.emoji]),
            el("span",{className:"task-label"+(t.done?" done":"")},[t.label]),
            el("button",{className:"del-btn",onclick:(e)=>{e.stopPropagation();deleteTask(t.id);}},["√ó"]),
          ],{onclick:()=>toggleTask(t.id),style:{opacity:t.done?"0.6":"1"}})
        ),
        el("button",{className:"add-btn",style:{borderColor:mem.color,color:mem.color},onclick:()=>{
          state.modal={type:"task",memberId:mem.id,emoji:"ü¶∑",label:""};render();
        }},["Ôºã „Çø„Çπ„ÇØ„ÇíËøΩÂä†"]),
      ]),
    ]);
    frag.appendChild(card);
  });
  return frag;
}

function toggleTask(id){
  state.tasks=state.tasks.map(t=>t.id===id?{...t,done:!t.done}:t);render();
}
function deleteTask(id){
  state.tasks=state.tasks.filter(t=>t.id!==id);render();
}

// ‚îÄ‚îÄ Meals ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
function renderMeals(){
  const frag=document.createDocumentFragment();
  for(let i=0;i<7;i++){
    const d=new Date();d.setDate(d.getDate()+i);
    const key=dateKey(d.getFullYear(),d.getMonth(),d.getDate());
    const label=i===0?"„Åç„Çá„ÅÜ":i===1?"„ÅÇ„Åó„Åü":`${d.getMonth()+1}/${d.getDate()}(${WEEKDAYS[d.getDay()]})`;
    const m=state.meals[key]||{breakfast:"",lunch:"",dinner:""};

    const rows=[["breakfast","üåÖ „ÅÇ„Åï"],["lunch","‚òÄÔ∏è „Å≤„Çã"],["dinner","üåô „ÇÜ„ÅÜ„Åó„Çá„Åè"]].map(([slot,slotLabel])=>{
      const inp=el("input",{className:"meal-input",placeholder:"„É°„Éã„É•„Éº„ÇíÂÖ•Âäõ...",value:m[slot]||""});
      inp.addEventListener("input",e=>{
        state.meals={...state.meals,[key]:{...m,[slot]:e.target.value}};
      });
      return div("meal-row",[
        el("span",{className:"meal-slot"},[slotLabel]),
        inp,
      ]);
    });

    frag.appendChild(div("card",[
      el("div",{className:"meal-day-title"},[label]),
      ...rows,
    ]));
  }
  return frag;
}

// ‚îÄ‚îÄ Lists ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
function renderLists(){
  const frag=document.createDocumentFragment();
  state.lists.forEach(list=>{
    const done=list.items.filter(i=>i.done).length;
    const inp=el("input",{className:"add-item-input",placeholder:"ËøΩÂä†„Åô„Çã..."});
    const addBtn=el("button",{className:"add-item-btn",style:{background:list.color},onclick:()=>{
      if(!inp.value.trim()) return;
      list.items.push({id:Date.now(),text:inp.value.trim(),done:false});
      render();
    }},["ËøΩÂä†"]);
    inp.addEventListener("keydown",e=>{if(e.key==="Enter"){addBtn.click();}});

    frag.appendChild(div("card",[
      div("list-header",[
        div("list-title-row",[
          el("div",{className:"list-color-dot",style:{background:list.color}}),
          el("span",{className:"list-title"},[list.title]),
        ]),
        div("",[
          el("span",{className:"list-count"},[`${done}/${list.items.length}`]),
          el("button",{className:"del-btn",style:{marginLeft:"8px"},onclick:()=>{
            state.lists=state.lists.filter(l=>l.id!==list.id);render();
          }},["√ó"]),
        ]),
      ]),
      el("div",{},[
        ...list.items.map(item=>{
          const cb=el("div",{
            className:"check-box"+(item.done?" checked":""),
            style:item.done?{borderColor:list.color,background:list.color}:{},
            onclick:()=>{item.done=!item.done;render();}
          },[item.done?el("span",{style:{color:"white",fontSize:"11px",fontWeight:"bold"}},["‚úì"]):""].filter(Boolean));
          return div("list-item-row",[
            cb,
            el("span",{className:"item-text"+(item.done?" done":"")},[item.text]),
            el("button",{className:"del-btn",onclick:()=>{
              list.items=list.items.filter(it=>it.id!==item.id);render();
            }},["√ó"]),
          ]);
        }),
        div("add-item-row",[inp,addBtn]),
      ]),
    ]));
  });

  frag.appendChild(el("button",{className:"add-list-btn",onclick:()=>{
    state.modal={type:"list",title:"",color:"#4CAF50"};render();
  }},["Ôºã „É™„Çπ„Éà„ÇíËøΩÂä†"]));

  return frag;
}

// ‚îÄ‚îÄ Modal ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
function renderModal(){
  document.querySelectorAll(".modal-overlay").forEach(m=>m.remove());
  if(!state.modal) return;
  const {type}=state.modal;

  const box=div("modal-box",[]);
  const overlay=div("modal-overlay",[box],{onclick:()=>{state.modal=null;render();}});
  box.addEventListener("click",e=>e.stopPropagation());

  if(type==="event") buildEventModal(box);
  if(type==="task")  buildTaskModal(box);
  if(type==="list")  buildListModal(box);

  document.body.appendChild(overlay);
}

function buildEventModal(box){
  const m=state.modal;
  const inp=el("input",{className:"modal-input",placeholder:"‰æãÔºö„Åà„Çì„Åù„Åè„ÄÅ„Åä„Åü„Çì„Åò„Çá„ÅÜ„Å≥",value:m.title||""});
  inp.addEventListener("input",e=>m.title=e.target.value);
  setTimeout(()=>inp.focus(),100);

  const memberRow=div("",[
    ...MEMBERS.map(mem=>
      el("button",{
        className:"chip-btn",
        style:{borderColor:mem.color,background:m.memberId===mem.id?mem.color:"white",color:m.memberId===mem.id?"white":mem.color,marginRight:"6px",marginBottom:"6px"},
        onclick:()=>{m.memberId=mem.id;render();}
      },[`${mem.emoji}${mem.name}`])
    )
  ]);

  box.appendChild(el("div",{className:"modal-title"},[`üìÖ ${m.key} „Å´ „Çà„Å¶„ÅÑ„ÇíËøΩÂä†`]));
  box.appendChild(el("div",{className:"modal-label"},["„Çà„Å¶„ÅÑ„ÅÆ„Å™„Åæ„Åà"]));
  box.appendChild(inp);
  box.appendChild(el("div",{className:"modal-label",style:{marginTop:"10px"}},["„Å†„Çå„ÅÆ „Çà„Å¶„ÅÑÔºü"]));
  box.appendChild(memberRow);

  const confirm=el("button",{className:"modal-confirm",style:{background:"#FF6B9D"},onclick:()=>{
    if(!m.title.trim()) return;
    const mem=MEMBERS.find(x=>x.id===m.memberId);
    if(!state.events[m.key]) state.events[m.key]=[];
    state.events[m.key].push({id:Date.now(),title:m.title.trim(),memberId:m.memberId,color:mem.color});
    state.modal=null;render();
  }},["ËøΩÂä†„Åô„Çã"]);
  const cancel=el("button",{className:"modal-cancel",onclick:()=>{state.modal=null;render();}},["„Ç≠„É£„É≥„Çª„É´"]);
  box.appendChild(confirm);
  box.appendChild(cancel);
}

function buildTaskModal(box){
  const m=state.modal;
  const emojiRow=div("",[
    ...TASK_TEMPLATES.map(t=>
      el("button",{
        className:"emoji-btn"+(m.emoji===t.emoji?" active":""),
        style:{marginRight:"6px",marginBottom:"6px"},
        onclick:()=>{m.emoji=t.emoji;m.label=t.label;render();}
      },[t.emoji])
    )
  ]);

  const inp=el("input",{className:"modal-input",placeholder:"‰æãÔºö„ÅØ„Åø„Åå„Åç„ÄÅ„Åç„Åå„Åà",value:m.label||""});
  inp.addEventListener("input",e=>m.label=e.target.value);

  box.appendChild(el("div",{className:"modal-title"},["‚úÖ „Çø„Çπ„ÇØ„ÇíËøΩÂä†"]));
  box.appendChild(el("div",{className:"modal-label"},["„Åà„ÇÇ„Åò„Çí „Åà„Çâ„Å∂"]));
  box.appendChild(emojiRow);
  box.appendChild(el("div",{className:"modal-label",style:{marginTop:"10px"}},["„Çø„Çπ„ÇØ„ÅÆ„Å™„Åæ„Åà"]));
  box.appendChild(inp);

  box.appendChild(el("button",{className:"modal-confirm",style:{background:"#FF6B9D"},onclick:()=>{
    if(!m.label.trim()) return;
    state.tasks.push({id:Date.now(),memberId:m.memberId,emoji:m.emoji,label:m.label.trim(),done:false});
    state.modal=null;render();
  }},["ËøΩÂä†„Åô„Çã"]));
  box.appendChild(el("button",{className:"modal-cancel",onclick:()=>{state.modal=null;render();}},["„Ç≠„É£„É≥„Çª„É´"]));
}

function buildListModal(box){
  const m=state.modal;
  const inp=el("input",{className:"modal-input",placeholder:"‰æãÔºö„Åã„ÅÑ„ÇÇ„ÅÆ„ÄÅ„ÇÑ„Çã„Åì„Å®",value:m.title||""});
  inp.addEventListener("input",e=>m.title=e.target.value);
  setTimeout(()=>inp.focus(),100);

  const colors=["#4CAF50","#2196F3","#FF6B9D","#FF9800","#9C27B0","#F44336"];
  const colorRow=div("",[
    ...colors.map(c=>
      el("div",{
        className:"color-dot-sel",
        style:{background:c,borderColor:m.color===c?"#333":"transparent",marginRight:"6px"},
        onclick:()=>{m.color=c;render();}
      })
    )
  ],{style:{display:"flex",flexWrap:"wrap",gap:"4px"}});

  box.appendChild(el("div",{className:"modal-title"},["üìã „É™„Çπ„Éà„Çí‰ΩúÊàê"]));
  box.appendChild(el("div",{className:"modal-label"},["„É™„Çπ„Éà„ÅÆ„Å™„Åæ„Åà"]));
  box.appendChild(inp);
  box.appendChild(el("div",{className:"modal-label",style:{marginTop:"10px"}},["„ÅÑ„Çç"]));
  box.appendChild(colorRow);

  box.appendChild(el("button",{className:"modal-confirm",style:{background:m.color},onclick:()=>{
    if(!m.title.trim()) return;
    state.lists.push({id:Date.now(),title:m.title.trim(),color:m.color,items:[]});
    state.modal=null;render();
  }},["‰ΩúÊàê„Åô„Çã"]));
  box.appendChild(el("button",{className:"modal-cancel",onclick:()=>{state.modal=null;render();}},["„Ç≠„É£„É≥„Çª„É´"]));
}

// ‚îÄ‚îÄ Boot ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
render();

if("serviceWorker" in navigator){
  navigator.serviceWorker.register("sw.js").catch(()=>{});
}
</script>
</body>
</html>
